<!DOCTYPE html>
<html lang="ru">
   <head>
      <meta charset="UTF-8" />
      <title>Главная | VideoSearch</title>
      <link rel="stylesheet" href="styles.css" />
      <link
         href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&display=swap"
         rel="stylesheet"
      />
   </head>
   <body>
      <header class="header">
         <nav>
            <a href="index.html" class="logo"
               ><img
                  class="logo"
                  src="https://yappy.media/images/logo-full.svg"
                  imgfield="img"
                  style="max-width: 110px; width: 110px"
                  alt=""
            /></a>
            <div class="nav-links">
               <a href="index.html">Главная</a>
               <a href="search.html">Поиск</a>
               <a href="upload.html" class="active">Добавить</a>
            </div>
         </nav>
      </header>

      <main class="search-main">
         <div class="search-container">
            <input
               type="text"
               id="searchInput"
               placeholder="Введите запрос..."
            />
            <div id="searchResults" class="results-dropdown"></div>
         </div>
      </main>

      <footer class="site-footer">
         <div class="footer-content">
            <p>
               Сделано в рамках хакатона от ИТМО <strong>Dew Week 2025</strong>
            </p>
            <div class="developers">
               <span>Команда:</span>
               <ul>
                  <li>overfitters</li>
               </ul>
            </div>
         </div>
      </footer>
      <script>
         // Функция для отображения состояния "пусто"
         function showEmptyState(message = "Начните вводить запрос") {
            const resultsContainer = document.getElementById("searchResults");
            resultsContainer.innerHTML = `
                <div class="empty-results">
                    <img src="https://yappy.media/images/search-nothing.svg" 
                         alt="Интересные видео уже в Yappy!" 
                         width="56" 
                         height="56">
                    <p>${message}</p>
                </div>
            `;
         }

         // Показываем начальное состояние при загрузке страницы
         document.addEventListener("DOMContentLoaded", function () {
            showEmptyState();
         });

         document
            .getElementById("searchInput")
            .addEventListener("input", async function (e) {
               const query = e.target.value.trim();
               const resultsContainer =
                  document.getElementById("searchResults");

               if (!query) {
                  showEmptyState();
                  return;
               }

               try {
                  const response = await fetch(
                     `http://localhost:5005/api/search?query=${encodeURIComponent(
                        query
                     )}`
                  );
                  const videoUrls = await response.json();

                  if (videoUrls.length > 0) {
                     resultsContainer.innerHTML = videoUrls
                        .map(
                           (url) => `
                        <div class="result-card">
                            <div class="video-preview" data-url="${url}"></div>
                            <h3>${url.split("/").slice(-2, -1)[0]}</h3>
                            <div class="video-url">${url}</div>
                        </div>
                    `
                        )
                        .join("");
                  } else {
                     showEmptyState("Ничего не найдено");
                  }
               } catch (error) {
                  console.error("Ошибка поиска:", error);
                  resultsContainer.innerHTML = `
                    <div class="error-state">
                        Ошибка соединения с сервером. Попробуйте позже.
                    </div>
                `;
               }
            });
      </script>
   </body>
</html>
